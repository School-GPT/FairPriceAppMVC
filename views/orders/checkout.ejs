<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - FairPrice App</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #fafafa;
            font-family: 'Poppins', sans-serif;
        }

        .page-title {
            font-weight: 700;
            margin-top: 30px;
            text-align: center;
            color: #444;
        }

        .glass-card {
            background: rgba(255,255,255,0.65);
            padding: 30px;
            border-radius: 20px;
            margin-top: 25px;
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .product-img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .price-tag {
            color: #ff3d3d;
            font-weight: bold;
        }

        .checkout-btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background: #ff4d4d;
            color: white;
            font-weight: bold;
            border-radius: 20px;
            border: none;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .checkout-btn:hover {
            background: #e60000;
        }

        .form-control {
            border-radius: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.8);
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<%- include('../partials/navbar', { user: user }) %>

<!-- ALERTS -->
<div class="container mt-3">
    <%- include('../partials/alerts', { errors: errors, messages: messages }) %>
</div>

<h2 class="page-title"> Checkout</h2>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <div class="glass-card">

                <!-- When cart is empty -->
                <% if (cart.length === 0) { %>
                    <p class="text-center fw-bold fs-5">Your cart is empty.</p>
                    <div class="text-center">
                        <a href="/shopping" class="btn btn-outline-dark mt-3" style="border-radius: 20px;">
                            ‚Üê Back to Shopping
                        </a>
                    </div>
                <% } else { %>

                <!-- ORDER SUMMARY -->
                <h4 class="fw-bold mb-3">Order Summary</h4>

                <table class="table align-middle">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>

                    <tbody>
                        <% let grandTotal = 0; %>

                        <% cart.forEach(item => { %>

                            <% let total = item.price * item.quantity; %>
                            <% grandTotal += total; %>

                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="/images/<%= item.image %>" class="product-img me-3">
                                        <%= item.productName %>
                                    </div>
                                </td>
                                <td><%= item.quantity %></td>
                                <td>$<%= item.price.toFixed(2) %></td>
                                <td class="fw-bold">$<%= total.toFixed(2) %></td>
                            </tr>

                        <% }) %>
                    </tbody>
                </table>

                <h4 class="text-end mt-3 fw-bold">
                    Grand Total:
                    <span class="price-tag">$<%= grandTotal.toFixed(2) %></span>
                </h4>

                <hr>

                <!-- BILLING DETAILS -->
                <h4 class="fw-bold mt-4">Billing Details</h4>

                <form action="/checkout" method="POST" class="mt-3">

                    <label class="fw-bold">Full Name</label>
                    <input type="text" name="fullname" class="form-control mb-3" required
                           value="<%= user.username || '' %>">

                    <label class="fw-bold">Address</label>
                    <input type="text" name="address" class="form-control mb-3" required
                           value="<%= user.address || '' %>">

                    <label class="fw-bold">Contact</label>
                    <input type="text" name="contact" class="form-control mb-3" required
                           value="<%= user.contact || '' %>">

                    <!-- Submit order -->
                    <button type="submit" class="checkout-btn">
                        Confirm Order 
                    </button>

                </form>

                <% } %>

            </div>

        </div>
    </div>
</div>

</body>
</html>
